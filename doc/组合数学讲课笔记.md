# 组合问题引入

## $36$军官问题

### 基本定义

- 拉丁方阵：设$S=\{s_1,s_2,\cdots,s_n\}$为$n$元集合，则满足下列条件的矩阵$A=(a_{i,j})_{n\times n}$则为$S$的一个拉丁方阵
  - $A$的每一行都是$S$的不同全排列
  - $A$的每一列都是$S$的不同全排列
  
- 正交拉丁方：设$A=(a_{i,j})_{n\times n},B=(b_{i,j})_{n\times n}$是两个$n$阶拉丁方，若$A,B$中元素组成的$n^2$个有序对$(a_{i,j},b_{i,j})$两两不同，则称$A$和$B$是正交的

### 正交拉丁方的存在性

- 除$n=1,2,6$外，均存在$n$阶正交拉丁方

#### 奇数阶拉丁方的构造法

设奇数$n=\prod_{i=1}^m{p_i^{t_i}},\text{其中}p\text{为奇素数,}t_i>0$

- 若存在至少一对$n_1$阶正交拉丁方和一对$n_2$阶正交拉丁方，则可构造一对$(n_1\times n_2)$的正交拉丁方

1. 构造$m=1$时的正交拉丁方

   - 当$n\ge3$时，可构造$(n-1)$个两两正交的拉丁方阵$L_1,L_2,\cdots,L_{n-1}$
   1. $L_i$的第一行均为$(1,2,3,\cdots,n)$
   
   2. 下一行的首个元素为上一行的行末值加$(i+1)$，若结果大于$n$则对$n$取余
   
   3. 若计算出行首元素为$j$，则本行所有元素为$(j,j+1,\cdots,n,1,2,\cdots,j-1)$
   
2. 构造$n=n_1\times n_2$阶的一对正交拉丁方
   
   1. 事先构造出一对$n_1$阶正交拉丁方$A$与一对$n_2$阶正交拉丁方$B$
   2. 将$n\times n$的矩阵分为$n_2\times n_2$个块，每个块$C_{i,j}$都设为$(A+n_2B_{i,j})$，此时的$C$即为满足要求的新的正交拉丁方

## 逐步受限游戏

### 逐步受限游戏定义

- 逐步受限游戏是图游戏（在图上进行的游戏）的一种

- 逐步受限游戏是满足这样条件的游戏：

  - 两个玩家轮番操作，且双方均绝对聪明
- 在相同局势下，双方所能进行的操作相同
  - 游戏必然在有限步结束，且一定不会以平局结尾
- 只会出现有限个局势，且局势不会重复
  
- 双方目标均为是自己在游戏中获胜

### 建立取胜策略的步骤

#### 建立状态转移图

建立一个与所考虑的游戏有关的有向图

- 每个顶点都代表游戏中的一个局势

- 每条有向边都代表从一个局势到另一个局势的转移

- 状态转移图为一个DAG，因此不会转移到出现过的状态

#### 一般必胜策略的理论

**名词定义**

- 逐步受限游戏的取胜局势：在这些局势下游戏将停止，且到达这个局势的玩家为胜者
- 所有出度为$0$的顶点均代表取胜局势，这些顶点又称取胜点
- 一个玩家的取胜策略是一种规则，它高斯了这个玩家在游戏中每一个阶段应该做哪个选择。才能确保该玩家最后一定进入取胜局势
- 任意与取胜点相邻的顶点在下列意义下为失利点：如果应该一个玩家移动到一个失利点，那么另一个玩家可以移动到一个取胜点
- 预胜点：若一个顶点的所有出边都会进入失利点，那么这个顶点为预胜点

**取胜策略**

找出所有的取胜点与预胜点，那么这些点所代表的局势为先手必胜／后手必败局势

排除取胜点与预胜点后，剩下的点都是失利点，这些点代表了先手必败／后手必胜局势

若进入了一个预胜点，则尽量转移到失利点，直到转移到取胜点，游戏结束为止

#### 有向图理论

**有向图的核**

有向图的核是有向图中满足以下条件的顶点的集合

- 没有连接核内任意两点的边

- 对于任何一个非核的顶点，它都存在一条到某个核顶点的出边

> 注意：不是每个有向图都有核

定理：若状态转移图有核$K$，则先手玩家的取胜策略为尽量移动到$K$内的顶点，但如果起始点在$K$内，则后手玩家可使用这种取胜策略

**图的层次**

递归地定义有向图中顶点$x$的层次$l(x)$，以及位于不超过$k$层的所有节点的集合$L_k$

设$S(x)=\{y\mid (x,y)\in E\}$为$x$的后续顶点集合，则有以下结论成立
$$
l(x)=0\iff S(x)=\oslash\\
L_0=\{x\mid l(x)=0\}\\
l(x)=1\iff x\notin L_0且S(x)\subseteq L_0\\
L_1=L_0\cup\{x\mid l(x)=1\}
$$
一般的，有下列结论成立
$$
l(x)=k\iff x\notin L_{k-1}且S(x)\subseteq L_{k-1}\\
L_k=L_{k-1}\cup \{x\mid l(x)=k\}\\
l(x)=k\iff从x出发的最长路的长度为k
$$
定理：每个逐步受限游戏都有唯一的取胜策略，即每个逐步受限问题的状态转移图都有唯一的核

> 定理证明：设$I_k$是$L_k$中核节点的集合。首先对于$L_0$，有$I_0=L_0$成立；其次，归纳假设对于$n\ge 1$，已经唯一确定$I_{n-1}$，则$I_n$可由$I_{n-1}\cup\{x\in L_n-L_{n-1}\mid \forall y\in I_{n-1},(x,y)\notin E \}$得到

# 存在性问题

- 抽屉原理

- 构造方法

- $Ramsey$定理

## 抽屉原理

### 定理形式

- 将$(n+1)$个对象放入$n$个盒子，则至少有一个盒子包含不少于$2$个对象
- 将$m$个对象放入$n$个盒子，则至少有一个盒子包含至少$\left \lfloor \frac{m-1}{n}\right\rfloor+1$个对象 
- 将$m$个对象放入$n$个盒子，则至少有一个盒子包含最多$\left \lfloor \frac{m}{n}\right\rfloor$对象 
- 若将$(m_1+m_2+\cdots+m_n+1)$个对象放入$N$个盒子，则第一个盒子中至少有$(m_1+1)$个，或第二个盒子中至少有$(m_2+1)$个，……，或第$n$个盒子中至少有$(m_n+1)$个

### 例题

> 设$k$为给定的正整数，求最小正整数$n$，使得对任意$n$个整数，其中必有两个，它们的和或差被$2k$整除

设$a_1,a_2,\cdots,a_n$为任意$n$个整数，它们被$2k$除的余数为$r_1,r_2,\cdots,r_n\in\{0,1,2,\cdots,2k-1\}$，将余数分组：$\{0\},\{1,2k-1\},\{2,2k-2\},\cdots,\{k-1,k+1\},\{k\}$，共$(k+1)$组。由抽屉原理的，$n\le k+2$

另一方面，取下列$(k+1)$个整数：$0,1,2,\cdots,k$，它们中任意两个的和或差多不是$2k$的倍数，所以$n\ge k+1$

所以$n=k+2$

> 集合$U=\{1,2,3,\cdots,3000\}$是否存在一个$2000$元子集$A$，使得当$x\in A$时，$2x\notin A$

设$A_0=\{4^nk\mid n\in\mathbb{N},k为奇数,且1\le4^nk\le3000\}$，则$A_0$中任意两个元素的比不等于$2$。可计算出$\left|A_0\right|=1999$

令$A_0=\{x_1,x_2,\cdots,x_{1999}\},S_i=\{x_i,2x_i\}\cap U(i=1,2,\cdots,1999)$，注意到所有这些$S_i(1\le i\le1999)$的并包含$U$，即$\bigcup_{i=1}^{1999}{S_i}\supseteq U$。由抽屉原理，$S$的任意$2000$个元素，必有两个在同一个$S_i$中，从而这$2000$个元素中有两个数，其中一个数时另一个的$2$倍

结论：不存在

> 集合$S=\{1,2,\cdots,49\}$任意划分成三个子集，证明存在一个子集含有三个不同的数$a,b,c$，使$a+b=c$

设$S=X\cup Y\cup Z$，由抽屉原理可知，必有一个子集（假设为$X$），包含至少$\left\lfloor\frac{49-1}{3}\right\rfloor+1=17$个元素，令$X=\{x_1,x_2,\cdots,x_{17},\cdots\},且x_1<x_2<\cdots<x_{17}$，做差得$16$个数：$x_2-x_1,x_3-x_1,\cdots,x_{17}-x_1$，记为$y_2,y_3,\cdots,y_{17}$

若$y_2,y_3,\cdots,y_{17}$中有一个为$x_1$,则从中去掉$x_1$，余下的至少有$15$个差不同于$x_1$

若这$15$个数中有一个在$X$中，则结论成立

若这$15$个数都不在$X$中，不放设$y_2,y_3,\cdots,y_{16}(不同与x_1)\in Y\cup Z$，由抽屉原理得。其中至少有$\left\lfloor\frac{15-1}{2}\right\rfloor+1=8$在同一个子集（假设为$Y$）中，不妨设$Y=\{y_1,y_2,\cdots,y_9,\cdots\},且y_1<y_2<\cdots<y_9$，做差得$7$个数：$y_3-y_2,y_4-y_2,\cdots,y_9-y_2$，记为$z_3,z_4,\cdots,z_9$

若$z_3,z_4,\cdots,z_9$中有一个为$y_2$,则从中去掉$y_2$，余下的至少有$6$个差不同于$y_2$

若这$6$个数有一个在$Y$中，则结论成立

若这$6$个数都不在$Y$中，则可能为$\left\{ \begin{array}{l}
	这6个数中有一个在X中\\
	这6个数都在Z中\\
\end{array} \right. $

- 若这$6$个数中有一个在$X$中，不妨设$z_3=y_3-y_2\in X$，则$z_3=(x_3-x_1)-(x_2-x_1)=x_3-x_2\in X$

  - 当$x_3\ne 2x_2$时，有$x_2,x_3,(x_3-x_2)$是$X$中三个不同的元素，结论成立

  - 当$x_3= 2x_2$时，若还有$z_i\in X(i\ne 3)$，有$x_2,x_i,(x_i-x_2)\in X$，结论成立

  - 否则$z_4,z_5,z_6,z_7\in Z$，考虑$\left. \begin{array}{r}
    	z_5-z_4=x_5-x_4=y_5-y_4\\
      	z_6-z_4=x_6-x_4=y_6-y_4\\
      	z_7-z_4=x_7-x_4=y_7-y_4\\
    \end{array} \right\} \in X\cup Y\cup Z$，结论成立
- 这$6$个数都在$Z$中，则考虑$\left. \begin{array}{r}z_4-z_3=x_4-x_3=y_4-y_3\\z_5-z_3=x_5-x_3=y_5-y_3\\
    	z_6-z_3=x_6-x_3=y_6-y_3\\
        	z_7-z_3=x_7-x_3=y_7-y_3\\
  \end{array} \right\} \in X\cup Y\cup Z$，结论成立

> 在一种彩票游戏中，一个人要从$1,2,3,\cdots,36$中选取$6$个不同的数填在一张彩票上，然后，彩票委员会从$1,2,3,\cdots,36$中随机选取$6$个数，然后一张不包含这$6$个数的票都可以中奖，证明有一种方案，买$9$张彩票可保证至少有一张中奖，而买$8$张彩票不一定能中奖

![test.png](https://i.loli.net/2019/08/23/VQciXPyAg5wNpZt.png)

- $9$张彩票构造方法：每张彩票均为两个不同连通块的两个点

- $8$张彩票失败构造方法

  - 若有一个数出现在$3$张彩票上，则选择这个数，以及余下$5$张彩票上各选择一个数，一定不会中奖

  - 若每个数之多出现在$2$张彩票上，$8$张彩票上共$48$个数，都是$\{1,2,3,\cdots,36\}$的数，则有$12$个数恰好出现$2$次，不妨设这些数为$1,2,3,\cdots,12$，则有：含有$1$的两张票上最多有$10$个不同的数，有至少一对数在其他彩票上，设其为$12$。

    只要选择$1$和$12$，再在其他未选择的彩票上选择一个数，则可保证无法中奖

> 在一次数学竞赛中，一些同学之间是朋友关系，且朋友关系是相互的，证明：存在由学生组成的一个子集$M$，使得$M$中每名同学在$M$中之多有$3$位朋友，不在$M$中的每名同学在$M$中至少有$4$位朋友

设$M_0=\oslash $，给出如下构造：

- 若$x\in M$，在$M$中$x$至少有$4$个朋友，则将$x$从$M$中移除

- 若$y\notin M$，在$M$中$y$至多有$3$个朋友，则将$y$加入到$M$中

利用上述方法，可构造出满足题意的$M$。

上述过程一定在有限步后停止的证明：

- 对于集合$M$，令$f(M)=7|M|-P(M),其中P(M)=|\{(x,y)\mid x,y\in M且x\ne y互为朋友\}|$。注意，$f(M)\le 7|M|\le7n,其中n为参加竞赛的人数$，且$f(M)$为整数。
- 在移除操作中，对于$x\in M$，$x$在$M$中至少有$4$个朋友，若从$M$移除$x$，则$P(M)$至少减少$8$，$|M|$减少$1$，也就是说，$f(M)$至少增加$1$。
- 在添加操作中，对于$y\notin M$，$y$在$M$中至多有$3$个朋友，若将$y$添加到$M$，则$P(M)$至少增加$6$，$|M|$增加$7$，也就是说，$f(M)$至少增加$1$。
- 因此，任何操作均能使$f(M)$增加，且$f(M)$为有上界的整数，故只能进行有限次操作。

## $Ramsey$定理

### 简单流行形式——友谊定理

- 任意$6$个人中，或者有$3$人互相认识，或者有$3$个人互相不认识
- 给$6$阶完全图$K_6$的边任意一个二染色，则必有至少一个同色三角形
- 任何一个$6$阶简单图中，一定存在一个三角形（即一个含有$3$个点的团）或一个有$3$个点的独立集

#### 证明

设这$6$个点为$A_1,A_2,A_3,A_4,A_5,A_6$，由抽屉原理得，$A_1$的所有连边中至少有$3$条边同色，不妨假设这些边连接到了$A_2,A_3,A_4$，讨论这三点之间的边：

- 三条边同色，则$A_2,A_3,A_4$形成同色三角形，定理成立

- 三条边不同色，则一定有一条边的颜色与这三点到$A_1$的边的颜色相同，形成含有$A_1$的同色三角形，定理成立

### $Ramsey$理论

#### 名词定义

对图$G=(V,E)$，其顶点集合为$V$，边集为$E$。

团：$G$的完全子图

独立集：$G$的一个顶点子集$S\subseteq V$，在$S$中任意两点间都没有边

若$G$没有较大的团，则可料想到$G$有较大的独立集，反之亦然

#### $Ramsey$数定义

给定任意正整数$k$和$l$，总存在一个最小正整数$r(k,l)$，使得每个有$r(k,l)$个点的图，或者包含一个有$k$个点的团，或者包含一个$l$个点的独立集，则$r(k,l)$称为Ramsey数

#### $Ramsey$图定义

一个有$(r(k,l)-1)$个顶点的图$G$，满足：$G$中既没有含$k$个点的团，又没有含$l$个点的独立集

#### $Ramsey$数性质

$$
\forall k,l>1\qquad r(k,l)\le r(k-1,l)+r(k,l-1)-[k,l均为偶数]
$$

$$
r(k,l)=r(l,k)
$$

$$
r(0,s)=0\quad r(1,s)=1\quad r(2,s)=s
$$

# 计数问题

- 加法原理&乘法原理

- 无重复元素的排列组合

- 可重复元素的排列组合

- 容斥原理

- 算两次

- 对应方法

- 代数方法（生成函数、$M\ddot{o}bius$变换，$Polya$计数）

- 递推方法

## 重集合的排列组合

- 重集合：若集合$S$中允许存在重复元素，那么这个集合为一个重集合

- 重集合的表示法：$S=\{n_1\cdot a_1,n_2\cdot a_2,\cdots,n_k\cdot a_k\}$表示元素$a_i$在$S$中最多出现$n_i$次，或者称元素$a_i$在$S$中的重复度为$n_i$

**重复度无限**

- 排列数——从$k$个不同元素中允许重复地选取$r$的排列数：$k^r$

- 组合数——从$k$个不同元素中允许重复地选取$r$的组合数：$C_{k+r-1}^r$

**给定重复度**

- 排列数：生成函数
- 组合数——$\sum x_i=r,0\le x_i\le n_i(i=1,2,\cdots,k)$的非负整数解个数：容斥原理或生成函数

**循环$r-$排列**

- 重复度无限：$M\ddot{o}bius$反演
- 给定重复度：$Polya$计数

**一般图上的重复排列**

- $Polya$计数

### 排列组合例题

> 方程$x+y+z=2010$中满足$x\le y\le z$ 的正整数解的个数是多少？

首先，$x+y+z=2010$的正整数解的个数：$C_{2009}^2=2017036$

其次，把满足$x\le y\le z$的正整数解分为三类

- $x=y=z$：$1$组解$x=y=z=670$

- $x,y,z$中有且仅有两个相等：相当于$2a+b=2010,a\ne b$，共有$1003$组解

- $x,y,z$两两不等：设个数为$k$，则有$C_{2009}^2=1+3\times1003+6k$，因此$k=335671$

所以，满足$x\le y\le z$ 的正整数解共有$336675$组

> 设$S=\{1,2,\cdots,n\}$，$A$为至少含有两项的、公差为正的等差数列，其项都在$S$中，且点$S$中其他元素置于$A$前或$A$后时，均不能构成与$A$有相同公差的等差数列（即$A$为一个”极大的“等差数列），求这样的等差数列的个数

当$n=2k$为偶数时，满足题中要求的每个数列$A$必有连续两项$a_i$与$a_{i+1}$，使$a_i\in \{1,2,\cdots,k\},a_{i+1}\in\{k+1,k+2,\cdots,n\}$

反之，从$\{1,2,\cdots,k\}$和$\{k+1,k+2,\cdots,n\}$中各取一个数，并以两者的差为公差，必可作出一个满足要求的数列$A$

所以这个对应为双射，这样的数列个数为$k^2=\frac{n^2}{2}$

同理，当$n=2k+1$为奇数时，数列个数为$k(k+1)=\frac{1}{4}(n^2+1)$

> 求整数$1,2,\cdots,10$的不同排列$a_1,a_2,\cdots,a_{10}$的数目，使得$a_i>a_{2i}(i=1,2,3,4,5)$，及$a_i>a_{2i+1}(i=1,2,3,4)$

易知大小关系满足下列树结构

![](https://raw.githubusercontent.com/MrFoodinChina/Clouding/master/image/test.png)

用$T_i$表示$a_i$及$a_i$一下的步伐，$f(T_i)$表示$T_i$满足条件的填写的方法数，原问题即为求$T_1$

向上递推可得：

> 设$k$为一个正整数，求满足下列条件不超过$10^k$的非负整数$n$的个数：
>
> - $3\mid n$
> - $n$的十进制表示中每个数码都为$2,0,1,7$之一

**法一**

考虑有$2,0,1,7$组成的长为$k$的序列，$a_k,b_k,c_k$表示这$k$向的和模$3$的余数分别为$0,1,2$的序列个数，则$a_k+b_k+c_k=4^k$

可推出转移方式为：
$$
\begin{array}{c}
	a_k=a_{k-1}+b_{k-1}+2c_{k-1}\\
	b_k=2a_{k-1}+b_{k-1}+c_{k-1}\\
	c_k=a_{k-1}+2b_{k-1}+c_{k-1}\\
\end{array}
$$
转移矩阵为：
$$
\left( \begin{array}{c}
	a_k\\
	b_k\\
	c_k\\
\end{array} \right) =\left( \begin{matrix}
	1&		1&		2\\
	2&		1&		1\\
	1&		2&		1\\
\end{matrix} \right) \left( \begin{array}{c}
	a_{k-1}\\
	b_{k-1}\\
	c_{k-1}\\
\end{array} \right) 
$$
**法二**

$\because 3\mid 10^k\quad\therefore $只考虑不超过不超过$k$为的非负整数

记$S=\{2,0,1,7\}$，考虑数$\overline{a_1a_2\cdots a_k}$（不足的在前面补$0$），其中$a_i\in S$，且有$3\mid \overline{a_1a_2\cdots a_k}\iff3\mid a_1+a_2+\cdots+a_k$，所以只要求满足这个条件的有序组$(a_1,a_2,\cdots,a_k)$的个数

考虑多项式$f(x)=(x^2+x^0+x^1+x^7)^k=\sum x^{a_1+a_2+\cdots+a_k}$满足条件的有序组的个数等于$f(x)$中次数为$3$的倍数的项的系数之和，记为$T$

设$f(x)=\sum_{j=0}^{7k}b_jx^j$，则$T=\sum_{t=0}^{\left\lfloor\frac{7k}{3}\right\rfloor}b_{3t}$

令$\omega=e^{\frac{2\pi i}{3}}$，则$1+\omega^j+\omega^{2j}=3[3\mid j]$，因此$T=\frac{f(1)+f(\omega)+f(\omega^2)}{3}=\left\{ \begin{array}{l}
	\frac{4^k+2}{3}\quad 3\mid k\\
	\frac{4^k-1}{3}\quad else\\
\end{array} \right. $

> 将符号$+$和$-$插入数$0,1,2,\cdots,12$之间，使得表达式$0\pm 1\pm 2\pm \cdots\pm 12$的值为$5$的倍数，求这样的插入方式的数目

构造生成函数：$f(x)=x^0(x^1+x^{-1})(x^2+x^{-2})\cdots(x^{12}+x^{-12})=\prod_{j=1}^{12}{x^j+x^{-j}}$

由于$f(x)$展开式中的每一项与表达式$0\pm 1\pm 2\pm \cdots\pm 12$时一一对应的，所有只要求$f(x)$展开式中次数为$5$的倍数的项的系数之和，利用五次单位根得：$ans=\frac{f(1)+f(\omega)+f(\omega^2)+f(\omega^3)+f(\omega^4)}{5}=816$

> 一副三色牌，共$39$张，其中红、黄、蓝每种颜色各$13$张，编号分别为$1,2.\cdots,13$，另外有大王、小王各一张，编号均为$0$
>
> 从这副牌中任取若干张，然后按以下规则计算分值：每种编号为$k$的牌计为$2^k$分
>
> 若题目的分值之和为$2014$，求称为一手“好牌”，求“好牌”牌组的个数

**法一**

称原问题为“两王问题”，若增加一张王牌（称为“中王”），编号也为$0$，再考虑同样的问题，称为“三王问题”

先考虑“三王问题”，将大、中、小王分别染成红、黄、蓝，于是，每种颜色的牌各$14$张，记分值为$n$的牌组的个数为$a_n$

令$x,y,z$分别为其中红、黄、蓝色牌的分值之和，则$a_n$就是$x+y+z=n$的非负整数解的个数（隐含定理：二进制表示的唯一性），即$a_n=C^{2}_{n+2}=\frac{1}{2}(n+1)(n+2)$

现在考虑“两王问题”，用$b_n$表示分值之和为$n$的“两王问题”中牌组的个数（求$b_{2014}$）

当$n=2l\le2014$时，有

- 若牌组内无“王”，则该组牌就是“三王问题”中对应于分值之和为$l$的牌组，其数目为$a_l$

- 若牌组内有“王”，由于$n=2l$为偶数，因此必含大小王两张牌，去掉”王“后可化为分值之和为$n-2=2l-2$的无”王“的情形，其数目为$a_{l-1}$

综合二者，可知$b_{2l}=a_l+a_{l-1}$

**法二**

大小王的选取所对应的代数式为$(1+x^{2^0})(1+x^{2^0})$，编号为$k$的牌的选取所对应的代数式为$(1+x^{2^k})(1+x^{2^k})(1+x^{2^k})$

对应$n\in \mathbb{N}$，分值之和为$n$的牌组与$f(x)=(1+x^{2^0})^2(1+x^{2^1})^3(1+x^{2^2})^3\cdots(1+x^{2^{13}})^3$的展开式中次数为$n$的项一一对应，分值之和为$n$的牌组的个数$b_n$登月$f(x)$展开式中$x^n$的系数

化简可得，$f(x)=\frac{(1-x^{2^{14}})^3}{(1-x^2)(1-x)^2}$由于$2\le2014\le2^{14}$，因此$b_{2014}$等于$\frac{1}{(1-x^2)(1-x)^2}$展开式中$x^{2014}$的系数，即$(\frac{2014}{2}+1)^2=1016064$

> 将周长为$24$的圆周等分为$24$段，从$24$个分点中选取$8$个点，使得其中任意两点所夹的弧长不等于$3$和$8$，问满足要求的$8$点但不同的取法有多少种？

设$24$个分点依次为$1,2,3,\cdots,24$

考虑下表：

| $1$  | $4$  | $7$  | $10$ | $13$ | $16$ | $19$ | $22$ |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| $9$  | $12$ | $15$ | $18$ | $21$ | $24$ | $3$  | $6$  |
| $17$ | $20$ | $23$ | $2$  | $5$  | $8$  | $11$ | $14$ |

表中每行相邻两数代表的顶点所夹弧长为$3$，相邻两列所代表的顶点所夹弧长为$8$（其中首行与末行，首列与末列认为是相邻的），所要选取的$8$点组即为表中选取$8$个数，使它们互不相邻

现在设每列为一个顶点，相邻两列所对应的顶点连一条边，得到一个图$G=C_8(长为8的圈)$，用三种不同颜色给节点染色，使得相邻顶点颜色不同，这样的染色方式与选取的满足条件的$8$点组是一一对应的

求用$m$种颜色给$C_n$染色且相邻顶点不同色的方式总数$a_n(m)$:

- 不考虑原图是一个圈的染色方式总数：$m(m-1)^{n-1}$种

- $v_1$与$v_n$不同色的方案总数：$a_n(m)$

- $v_1$与$v_n$同色的方案总数：将$v_1$与$v_n$合并可知，此时方案数为$a_{n-1}(m)$

得递推式：$a_n(m)=m(m-1)^{n-1}-a_{n-1}(m-1)$

解递推式得：$a_n(m)=(m-1)^n+(-1)^n(m-1)$

## 十二模式

令$A$和$B$为两个有限集，$|A|=n,|M|=m$，要计数在某些限制下映射$f:A\rightarrow B$的个数

- 映射$f:A\rightarrow B$自身的三种限制
  - $f$是任意映射
  - $f$为单射
  - $f$为满射
  
- $A$和$B$中的元素是“可区分的”，还是“不可区分的”

> **例**
>
> $A=\{1,2,3\},B=\{a,b,c,d\}$
>
> $f,g,h,l:A\rightarrow B$定义如下：
>
> $f(1)=f(2)=a,f(3)=b\\g(1)=g(3)=a,g(2)=b\\h(1)=h(2)=b,h(3)=d\\l(2)=l(3)=b,l(1)=c$
>
> (I)$A$和$B$都是可区分的：
>
> | 函数＼$A$的元素＼$B$的元素 |  $a$  |  $b$  | $c$  | $d$  |
> | :------------------------: | :---: | :---: | :--: | :--: |
> |     $f:A\rightarrow B$     | $1,2$ |  $3$  |      |      |
> |     $g:A\rightarrow B$     | $1,3$ |  $2$  |      |      |
> |     $h:A\rightarrow B$     |       | $1,2$ |      | $3$  |
> |     $l:A\rightarrow B$     |       | $2,3$ | $1$  |      |
>
> (II)$A$是不可区分的，$B$是可区分的：$f$与$g$等价
>
> (III)$A$是可区分的，$B$是不可区分的：$f$与$h$等价
> 
> (IV)$A$和$B$都是不可区分的：$f,g,h,l$均等价
>

下列表给出了各类不等价映射$f:A\rightarrow B$的个数，其中$|A|=n,|B|=m$

| $A$中元素是否可区分 | $B$中元素是否可区分 |    $f$为任意映射     |                          $f$为单射                           |    $f$为满射    |
| :-----------------: | :-----------------: | :------------------: | :----------------------------------------------------------: | :-------------: |
|       可区分        |       可区分        |        $m^n$         |                     $\frac{m!}{(m-n)!}$                      |   $m!S(n,m)$    |
|      不可区分       |       可区分        |    $C_{m+n-1}^n$     |                           $C_m^n$                            | $C_{n-1}^{n-m}$ |
|       可区分        |      不可区分       | $\sum^m_{i=0}S(n,i)$ | $\left\{ \begin{array}{l}	1\quad n\le m\\0\quad	n>m\end{array} \right.$ |    $S(n,m)$     |
|      不可区分       |      不可区分       | $\sum_{i=0}^mP_i(n)$ | $\left\{ \begin{array}{l}	1\quad n\le m\\0\quad	n>m\end{array} \right.$ |    $P_m(n)$     |

*其中$S(n,m)$代表斯特林数，$P_k(n)$代表将$n$拆分为恰好$k$个部分的分拆个数*

> **对$A$可区分，$B$不可区分，$f$为任意映射时的方案数的证明**
>
> $\because M$元素不可区分
>
> $\therefore f:A\rightarrow B$是由非空集$f^{-1}(y)(y\in B)$确定，其中$f^{-1}(y)=\{x\mid x\in A,f(x)=y\}$，这些集合构造了$A$的一个划分$\pi$，这些集合最多有$m$个
>
> $\therefore$答案为$\sum^m_{i=0}S(n,i)$

### 例题

> 令$n$和$k$是两个给定的正整数，求有多少个由$A=\{1,2,\cdots ,n\}$的子集组成的序列$(X_1,X_2,\cdots,X_k)$，使得$\bigcap_{i=1}^k{X_i}=\oslash$

用$f(k,n)$表示这个数，设$\bigcap_{i=1}^{k-1}{X_i}=T$，其中$|T|=i$

若$Y_j=X_j-T$，则有$\bigcap_{i=1}^{k-1}{Y_i}=\oslash$，且$Y_j\subseteq A-T$，反之亦然，可知，一个有$f(k-1,n-i)$个序列$(X_1,X_2,\cdots,X_{k-1})$，满足$\bigcap_{i=1}^{k-1}{X_i}=T$

对于每个这样的序列$(X_1,X_2,\cdots,X_{k-1}),其中\bigcap_{i=1}^{k-1}{X_i}=T$，$X_k$可以是$(A-T)$的任何一个子集，使得$\bigcap_{i=1}^k{X_i}=\oslash$，所以$X_k$有$2^{n-i}$中选择方式

$\therefore f(k,n)=\sum^n_{i=0}f(k-1,n-i)\times 2^{n-i}\times C_n^i$

求生成函数可得
$$
F_k(x)=\sum_{n=0}^\infty f(k,n)\frac{x^n}{n!}\\
=\sum_{n=0}^\infty (\sum^n_{i=0}f(k-1,n-i)\times 2^{n-i}\times C_n^i)\frac{x^n}{n!}\\
=(\sum_{i=0}^\infty \frac{x^i}{i!})(\sum_{n=0}^\infty f(k-1,n)\frac{(2x)^n}{n!})\\
=e^xF_{k-1}(2x)
$$
由于$F_1(x)=e^x$，那么$F_k(x)=exp(x+2x+4x+\dots+2^{k-1}x)=exp((2^k-1)x)=\sum_{n=0}^\infty \frac{(2^k-1)^nx^n}{n!}$

$\therefore f(k,n)=(2^k-1)^n$

> 设$S=\{1,2,\cdots,2n\}$，求$S$的子集$T$的个数，使得$T$中不存在两个元素$a,b$，满足$|a-b|=1$或$|a-b|=n$

互斥表为

| $1$  | $2$  | $3$  | $4$ | $\cdots$ | $n-2$ | $n-1$ | $n$ |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| $n+1$  | $n+2$ | $n+3$ | $n+4$ | $\cdots$ | $2n-2$ | $2n-1$  | $2n$  |

设满足*(1)相邻格的数不同时选取 (2)$n$与$n+1$不同时选取* 时的方案数为$S(n)$

令$A(n),B(n),C(n)$分别表示从上下三个表选数，使得相邻数不同时选取的方案数

| $1$  | $2$  | $3$  | $4$ | $\cdots$ | $n-2$ | $n-1$ | $n$ |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|   | $n+2$ | $n+3$ | $n+4$ | $\cdots$ | $2n-2$ | $2n-1$  | $2n$  |



| $1$  | $2$  | $3$  | $4$ | $\cdots$ | $n-2$ | $n-1$ |  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|   | $n+2$ | $n+3$ | $n+4$ | $\cdots$ | $2n-2$ | $2n-1$  | $2n$  |

分析可得递推公式

- $A(n)$的计算
  - $1,(n+1)$均不选取：$A(n-1)$种
  - 刚好选取$1,(n+1)$中的一个：各为$B(n-1)$种
  - $A(1)=3,A(2)=7$
- $B(n)$的计算：$B(n)$
  - 选取$1$：$B(n-1)$种
  - 不选取$1$：$A(n-1)$种
- $C(n)$的计算：$C(n)=B(n-1)+B(n-2)+C(n-2)$
  - 不选取$1$：$B(n-1)$种
  - 选取$1$，但不选取
- $S(n)$的计算：$S(n)=A(n)-C(n-2)$

通项公式为$S(n)=\frac{(3+\sqrt{2})(1+\sqrt{2})^n-(3-\sqrt{2})(1-\sqrt{2})^n-2(-1)^n}{4}$

> 某人希望写出所有的由$100$个正整数所构成的数列，满足在每个数列中均有等于$4$或$5$的项，且相邻两项的差的绝对值不大于$2$，求这样的数列有多少个？

将含有$n$项的满足要求的数列（称为“好数列”）的个数记为$S_n$，原问题即为求$S_{100}$的值

当$n=1$时，易知$S_1=2$

假设已经计算出$S_k$，下面递推得到$S_{k+1}$

考虑任意一个含有$k$项的好数列。设最后一项为$j$，则在它后添上一个介于$(j-2)$与$(j+2)$之间的正整数，即可得到一个含$(k+1)$项的“好数列”；若添加的这个数为非正整数（只可能为$0$或$-1$），则只要将数列中每一项均加上$5$，达到一个含有$(k+1)$项的好数列，可以证明不会与任意其他数列重复。

> **加值不会使两数列重复证明**
>
> 易知
>
> - 那些无需将各项均加$5$的数列虽然各不相同，但这些数列中前$k$项中必有$4$或$5$
>
> - 哪些各项均加$5$的数列相互之间是不同的，且前$k$项中没有$4$或$5$（只有最后一项为$4$或$5$）（前$k$项必有$9$或$10$）
>
> 因此，加值的数列一定与不加值的数列重复
>
> 同时，由于前$k$项不相同，所有加相同值的数列均不重复

在由$k$项“好数列”构造出的$(k+1)$项“好数列”中没有包括那些 前$k$项中均不出现$4,5,9,10$，且第$(k+1)$项为$4$或$5$的“好数列”，但这些数列的前$k$项的数只能是$\{1,2,3\}$中的元素，或是$\{6,7,8\}$中的元素

- 若上述数列前$k$项的数在$\{1,2,3\}$中，则一共有$3^k$种“好数列”
- 若前$k$项的数在$\{6,7,8\}$中，则也有$3^k$种“好数列”

因此，递推公式为$S_{k+1}=S_k+2\times 3^k$，通项公式为$S_k=5^k-3^k$

结论：$S_{100}=5^{100}-3^{100}$

> 一种密码锁的密码设置是在正$n$边形$A_1A_2\cdots A_n$的每个顶点处赋值$0$或$1$两个数中的一个，同时，在每个顶点处染红、蓝色中的一个，使得相邻的两个顶点的数字或颜色中至少有一个相同，问：该种密码锁有多少种不同的密码设置？

若从$A_i$到$A_{i+1}$，数字不同但颜色相同，则$A_iA_{i+1}$记为$a$边；数字相同但颜色不同则记为$b$边；数字、颜色均相同则记为$c$边

对于给定的点$A_1$的配置（数字、颜色的填充方案，共$4$种可能），按照边上的字母可以确定$A_2,A_3,\cdots,A_n$上的配置，为了使得最终回到$A_i$时的配置，正$n$边形上$a,b$边的出现次数均为偶数

设$a$边有$2i$条$(0\le i\le\left\lfloor\frac{n}{2}\right\rfloor)$，$b$边有$2j$条$(0\le j\le\left\lfloor\frac{n}{2}\right\rfloor)$，满足$2i+2j\le n$，即$i+j\le\left\lfloor\frac{n}{2}\right\rfloor$，$c$边有$(n-2i-2j)$条

选取$a$边的方式有$C_n^{2i}$种，选取$a$边的方式有$C_{n-2i}^{2j}$种，对给定的$i,j$，共有$4\times C_n^{2i}\times C_{n-2i}^{2j}$种

对$i,j$求和，得密码设置的不同数目为：$f(n)=\sum^{\left\lfloor\frac{n}{2}\right\rfloor}_{i=1}\sum^{\left\lfloor\frac{n-2i}{2}\right\rfloor}_{i=1}(4\times C_n^{2i}\times C_{n-2i}^{2j})=\left\{ \begin{array}{l}
	3^n+3\quad 2\mid n\\
	3^n+1\quad else\\
\end{array} \right. $

> 设$A=\{1,2,\cdots,2012\},B=\{1,2,\cdots,19\}$，$S$是集合$A$的所有子集构成的集合（即$S=2^A$为$A$的幂集），求映射$f:S\rightarrow B$的个数，使得任意$X_1,X_2\in S$，均有$f(X_1\cap X_2)=\min(f(X_1),f(X_2))$

设$A_i=A-\{i\}$

任意一个满足条件的映射$f:S\rightarrow B$是由$(f(A),f(A_1),f(A_2),\cdots,f(A_{2012})$唯一确定的

对于任意有限非空集$U,V$，及$U\cup V$中的最小元就是$U$中最小元与$V$中最小元中较小的一个，即$\min(U\cup V)=\min(\min U,\min V)$

设$f(A)=n$，则一定有$f(x)\le n,x\in S$（证明：$f(x)=f(x\cap A)=\min(f(x),f(A))\le f(A)=n$）

下面考虑$A$的$2011$元自己$X$，即$|X|=2011$，这样的$X$共有$2012$个

令它们为$A_1,A_2,\cdots,A_{2012}$，则有$f(A_i)\in\{1,2,\cdots,n\}$，有$n$中选取方式。因此，有$n^{2012}$中方式确定$(f(A_1),f(A_2),\cdots,f(A_{2012}))$

进一步可证：$f$在其他集合$(S-A)$上的取值完全由$(f(A),f(A_1),f(A_2),\cdots,f(A_{2012})$唯一确定

令$X=A-\{a_1,a_2,\cdots,a_k\}$，对$k$用归纳法，得$f(X)=\min\{f(A_{a_1}),f(A_{a_2}),\cdots,f(A_{a_k})\}$

$\because n\in B$，即$1\le n\le 19$

$\therefore$满足条件的映射$f$总数为$\sum_{i=1}^{19}i^{2012}$